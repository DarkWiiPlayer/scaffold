
<!doctype html>
<html lang="en">
  <head>
    <title>Code coverage report for scaffold</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./style/reset.css">
    <link rel="stylesheet" href="./style/style.css">
  </head>
  <body>
   <div id="page-container">
      <header>
        <nav>
          
<ul class="inline-list">
    <li>
      <a href="./index.html">All Files</a> /
    </li>

  <li>scaffold.lua</li>
</ul>

        </nav>
      </header>

      <main>
        <header class="hit-miss-statistics">
          
<ul class="inline-list">
  <li>
    <span class="strong">95.89%</span>
    <span class="quiet">Rate</span>
  </li>
  <li>
    <span class="strong">70</span>
    <span class="quiet">Hits</span>
  </li>
  <li>
    <span class="strong">3</span>
    <span class="quiet">Missed</span>
  </li>
</ul>

<div class="hit-percentage-status hit-percentage-status-high"></div>

        </header>
        <section id="content">
          
  <section class="file-coverage">

    <ul class="line-numbers undecorated">
        <li>1</li>
        <li>2</li>
        <li>3</li>
        <li>4</li>
        <li>5</li>
        <li>6</li>
        <li>7</li>
        <li>8</li>
        <li>9</li>
        <li>10</li>
        <li>11</li>
        <li>12</li>
        <li>13</li>
        <li>14</li>
        <li>15</li>
        <li>16</li>
        <li>17</li>
        <li>18</li>
        <li>19</li>
        <li>20</li>
        <li>21</li>
        <li>22</li>
        <li>23</li>
        <li>24</li>
        <li>25</li>
        <li>26</li>
        <li>27</li>
        <li>28</li>
        <li>29</li>
        <li>30</li>
        <li>31</li>
        <li>32</li>
        <li>33</li>
        <li>34</li>
        <li>35</li>
        <li>36</li>
        <li>37</li>
        <li>38</li>
        <li>39</li>
        <li>40</li>
        <li>41</li>
        <li>42</li>
        <li>43</li>
        <li>44</li>
        <li>45</li>
        <li>46</li>
        <li>47</li>
        <li>48</li>
        <li>49</li>
        <li>50</li>
        <li>51</li>
        <li>52</li>
        <li>53</li>
        <li>54</li>
        <li>55</li>
        <li>56</li>
        <li>57</li>
        <li>58</li>
        <li>59</li>
        <li>60</li>
        <li>61</li>
        <li>62</li>
        <li>63</li>
        <li>64</li>
        <li>65</li>
        <li>66</li>
        <li>67</li>
        <li>68</li>
        <li>69</li>
        <li>70</li>
        <li>71</li>
        <li>72</li>
        <li>73</li>
        <li>74</li>
        <li>75</li>
        <li>76</li>
        <li>77</li>
        <li>78</li>
        <li>79</li>
        <li>80</li>
        <li>81</li>
        <li>82</li>
        <li>83</li>
        <li>84</li>
        <li>85</li>
        <li>86</li>
        <li>87</li>
        <li>88</li>
        <li>89</li>
        <li>90</li>
        <li>91</li>
        <li>92</li>
        <li>93</li>
        <li>94</li>
        <li>95</li>
        <li>96</li>
        <li>97</li>
        <li>98</li>
        <li>99</li>
        <li>100</li>
        <li>101</li>
        <li>102</li>
        <li>103</li>
        <li>104</li>
        <li>105</li>
        <li>106</li>
        <li>107</li>
        <li>108</li>
        <li>109</li>
        <li>110</li>
        <li>111</li>
        <li>112</li>
        <li>113</li>
        <li>114</li>
        <li>115</li>
        <li>116</li>
        <li>117</li>
        <li>118</li>
        <li>119</li>
        <li>120</li>
        <li>121</li>
        <li>122</li>
        <li>123</li>
        <li>124</li>
        <li>125</li>
        <li>126</li>
        <li>127</li>
        <li>128</li>
        <li>129</li>
        <li>130</li>
        <li>131</li>
        <li>132</li>
        <li>133</li>
        <li>134</li>
        <li>135</li>
        <li>136</li>
        <li>137</li>
        <li>138</li>
        <li>139</li>
        <li>140</li>
        <li>141</li>
        <li>142</li>
        <li>143</li>
        <li>144</li>
        <li>145</li>
        <li>146</li>
        <li>147</li>
        <li>148</li>
        <li>149</li>
        <li>150</li>
        <li>151</li>
    </ul>

    <ul class="line-coverages undecorated">
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">5x</li>
        <li class="line-miss">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">10x</li>
        <li class="line-hit">7x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">28x</li>
        <li class="line-hit">61x</li>
        <li class="line-hit">33x</li>
        <li class="line-hit">33x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">46x</li>
        <li class="line-hit">46x</li>
        <li class="line-hit">46x</li>
        <li class="line-hit">111x</li>
        <li class="line-hit">80x</li>
        <li class="line-hit">18x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">46x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">21x</li>
        <li class="line-hit">21x</li>
        <li class="line-hit">21x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">14x</li>
        <li class="line-hit">14x</li>
        <li class="line-hit">2x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">12x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">19x</li>
        <li class="line-hit">15x</li>
        <li class="line-hit">15x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">11x</li>
        <li class="line-hit">7x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">19x</li>
        <li class="line-hit">12x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">19x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">10x</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">1x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">10x</li>
        <li class="line-hit">2x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">10x</li>
        <li class="line-hit">1x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">17x</li>
        <li class="line-hit">8x</li>
        <li class="line-hit">8x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">8x</li>
        <li class="line-hit">3x</li>
        <li class="line-hit">1x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">2x</li>
        <li class="line-hit">2x</li>
        <li class="line-hit">2x</li>
        <li class="line-miss">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">2x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">5x</li>
        <li class="line-hit">3x</li>
        <li class="line-hit">2x</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">1x</li>
        <li class="line-empty">
</li>
        <li class="line-miss">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">5x</li>
        <li class="line-hit">5x</li>
        <li class="line-hit">3x</li>
        <li class="line-hit">12x</li>
        <li class="line-hit">9x</li>
        <li class="line-hit">3x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">3x</li>
        <li class="line-hit">2x</li>
        <li class="line-hit">2x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
    </ul>

    <ul class="code undecorated">
        <li class="line-empty">--- A collection of functions that write things to a directory</li>
        <li class="line-empty">
</li>
        <li class="line-hit">local lfs = require &#39;lfs&#39;</li>
        <li class="line-empty">
</li>
        <li class="line-hit">local scaffold = {}</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Helper function to avoid messy indentation in source files.</li>
        <li class="line-empty">-- Removes whitespace up to and including the first non-whitespace character at the beginning of every line.</li>
        <li class="line-empty">-- @tparam string input A multiline string to remve indentation from.</li>
        <li class="line-empty">-- @usage</li>
        <li class="line-empty">-- scaffold.unindent [[</li>
        <li class="line-empty">-- 	|-- This file was generated automatically</li>
        <li class="line-empty">-- 	|function do_things()</li>
        <li class="line-empty">-- 	|	print &quot;This Lua file is nicely formatted&quot;</li>
        <li class="line-empty">-- 	|end</li>
        <li class="line-empty">-- ]]</li>
        <li class="line-hit">function scaffold.unindent(input)</li>
        <li class="line-hit">	if type(input) ~= &quot;string&quot; then</li>
        <li class="line-miss">		error(&quot;Expected string, got &quot;..type(input))</li>
        <li class="line-empty">	end</li>
        <li class="line-hit">	return input:gsub(&quot;[^\n]+&quot;, function(line)</li>
        <li class="line-hit">		return line:gsub(&quot;^%s*[^%s]&quot;, &quot;&quot;)</li>
        <li class="line-empty">	end)</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Creates a directory and all necessary parent directories.</li>
        <li class="line-hit">function scaffold.buildpath(path)</li>
        <li class="line-hit">	local slash = 0</li>
        <li class="line-hit">	while slash do</li>
        <li class="line-hit">		slash = path:find(&quot;&#47;&quot;, slash+1)</li>
        <li class="line-hit">		lfs.mkdir(path:sub(1, slash))</li>
        <li class="line-empty">	end</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Deletes a file or directory recursively</li>
        <li class="line-empty">-- @tparam string path The path to the file or directory to delete</li>
        <li class="line-hit">function scaffold.delete(path)</li>
        <li class="line-hit">	path = path:gsub(&#39;&#47;+$&#39;, &#39;&#39;)</li>
        <li class="line-hit">	local mode = lfs.attributes(path, &#39;mode&#39;)</li>
        <li class="line-hit">	if mode==&#39;directory&#39; then</li>
        <li class="line-hit">		for entry in lfs.dir(path) do</li>
        <li class="line-hit">			if not entry:match(&quot;^%.%.?$&quot;) then</li>
        <li class="line-hit">				scaffold.delete(path..&#39;&#47;&#39;..entry)</li>
        <li class="line-empty">			end</li>
        <li class="line-empty">		end</li>
        <li class="line-empty">	end</li>
        <li class="line-hit">	os.remove(path)</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Writes an arbitrarily nested sequence of strings to a file</li>
        <li class="line-empty">-- @param buffer A string or nested sequence of strings to be written.</li>
        <li class="line-empty">-- @tparam file file A file to write to (can be string or object with `write` method).</li>
        <li class="line-empty">-- @treturn number The number of bytes that were written</li>
        <li class="line-hit">function scaffold.file(buffer, file)</li>
        <li class="line-hit">	local bytes = 0</li>
        <li class="line-hit">	local close = false</li>
        <li class="line-hit">	if type(file) == &quot;string&quot; then</li>
        <li class="line-empty">		local err</li>
        <li class="line-hit">		file, err = io.open(file, &quot;wb&quot;)</li>
        <li class="line-hit">		if not file then</li>
        <li class="line-hit">			return nil, err</li>
        <li class="line-empty">		end</li>
        <li class="line-hit">		close = true</li>
        <li class="line-empty">	end</li>
        <li class="line-hit">	if type(buffer) == &quot;string&quot; then</li>
        <li class="line-hit">		file:write(buffer)</li>
        <li class="line-hit">		bytes = #buffer</li>
        <li class="line-empty">	else</li>
        <li class="line-hit">		for _, chunk in ipairs(buffer) do</li>
        <li class="line-hit">			bytes = bytes + scaffold.file(chunk, file)</li>
        <li class="line-empty">		end</li>
        <li class="line-empty">	end</li>
        <li class="line-hit">	if close then</li>
        <li class="line-hit">		file:close()</li>
        <li class="line-empty">	end</li>
        <li class="line-hit">	return bytes</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Builds a directory structure recursively from a table template.</li>
        <li class="line-empty">-- @tparam[opt=&quot;.&quot;] string prefix A prefix to the path, aka. where to initialize the directory structure.</li>
        <li class="line-empty">-- @tparam table tab A table representing the directory structure.</li>
        <li class="line-empty">-- Table entries are subdirectories, strings are files, false means delete,</li>
        <li class="line-empty">-- true means touch file, everything else is an error.</li>
        <li class="line-empty">-- @usage</li>
        <li class="line-empty">-- 	builddir {</li>
        <li class="line-empty">-- 		sub_dir = {</li>
        <li class="line-empty">-- 			file = &#39;Hello World!&#39;; -- new file</li>
        <li class="line-empty">-- 		}</li>
        <li class="line-empty">-- 		empty = true; -- new empty file</li>
        <li class="line-empty">-- 		delete_me = false; -- will be deleted</li>
        <li class="line-empty">-- 	}</li>
        <li class="line-hit">function scaffold.builddir(prefix, tab)</li>
        <li class="line-empty">	-- Prefix is optional</li>
        <li class="line-hit">	if not tab then</li>
        <li class="line-hit">		tab = prefix</li>
        <li class="line-hit">		prefix = &#39;.&#39;</li>
        <li class="line-empty">	end</li>
        <li class="line-empty">
</li>
        <li class="line-hit">	if lfs.attributes(prefix, &#39;mode&#39;) ~= &quot;directory&quot; then</li>
        <li class="line-hit">		scaffold.buildpath(prefix)</li>
        <li class="line-empty">	end</li>
        <li class="line-empty">
</li>
        <li class="line-hit">	if type(tab) ~= &#39;table&#39; then</li>
        <li class="line-hit">		error(&quot;Invalid argument; expected table, got &quot;..type(tab), 1)</li>
        <li class="line-empty">	end</li>
        <li class="line-empty">
</li>
        <li class="line-hit">	for path, value in pairs(tab) do</li>
        <li class="line-hit">		if prefix then</li>
        <li class="line-hit">			path = prefix..&quot;&#47;&quot;..tostring(path)</li>
        <li class="line-empty">		end</li>
        <li class="line-hit">		if type(value) == &quot;table&quot; then</li>
        <li class="line-hit">			if value[1] then</li>
        <li class="line-hit">				scaffold.file(value, path)</li>
        <li class="line-empty">			else</li>
        <li class="line-hit">				if lfs.attributes(path, &#39;mode&#39;) ~= &quot;directory&quot; then</li>
        <li class="line-hit">					local result, err = lfs.mkdir(path)</li>
        <li class="line-hit">					if not result then</li>
        <li class="line-miss">						error(&quot;Building &quot;..path..&quot;:&quot;..err)</li>
        <li class="line-empty">					end</li>
        <li class="line-empty">				end</li>
        <li class="line-hit">				scaffold.builddir(path, value)</li>
        <li class="line-empty">			end</li>
        <li class="line-hit">		elseif type(value) == &quot;string&quot; then</li>
        <li class="line-hit">			scaffold.file(value, path)</li>
        <li class="line-hit">		elseif value==true then</li>
        <li class="line-hit">			scaffold.file(&quot;&quot;, path)</li>
        <li class="line-hit">		elseif value==false then</li>
        <li class="line-hit">			scaffold.delete(path)</li>
        <li class="line-empty">		else</li>
        <li class="line-miss">			error(&quot;Unknown type at &quot;..path)</li>
        <li class="line-empty">		end</li>
        <li class="line-empty">	end</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Reads a directory into a table</li>
        <li class="line-hit">function scaffold.readdir(path)</li>
        <li class="line-hit">	local mode = lfs.attributes(path, &#39;mode&#39;)</li>
        <li class="line-hit">	if mode == &#39;directory&#39; then</li>
        <li class="line-hit">		local result = {}</li>
        <li class="line-hit">		for name in lfs.dir(path) do</li>
        <li class="line-hit">			if name:sub(1, 1) ~= &#39;.&#39; then</li>
        <li class="line-hit">				result[name] = scaffold.readdir(path..&quot;&#47;&quot;..name)</li>
        <li class="line-empty">			end</li>
        <li class="line-empty">		end</li>
        <li class="line-hit">		return result</li>
        <li class="line-hit">	elseif mode == &#39;file&#39; then</li>
        <li class="line-hit">		return(io.open(path, &#39;rb&#39;):read(&#39;a&#39;))</li>
        <li class="line-empty">	end</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-hit">return scaffold</li>
    </ul>

  </section>

        </section>
      </main>

      <footer class="quiet">
        Code coverage generated by <a href="https://keplerproject.github.io/luacov/" target="_blank">LuaCov</a> at 2022-11-23 12:50:54
      </footer>
    </div>
  </body>
</html>
